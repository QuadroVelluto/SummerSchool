## Тема: Настройка протоколов динамической маршрутизации RIP v2 и OSPF


1) **Для заданной на схеме schema-lab5 сети, состоящей из управляемых коммутаторов, маршрутизаторов и персональных компьютеров выполнить планирование и документирование адресного пространства и назначить статические адреса всем устройствам. nb! Каждое соединение маршрутизатора с маршрутизатором - это отдельная сеть.**

Сеть разбита на несколько областей: часть на RIP v2, часть на OSPF (Area 0, 1, 2). Для каждой подсети были выбраны адресные диапазоны:

RIP-сегменты:

    PC1-R4: 192.168.1.0/24
    PC2-R5: 192.168.2.0/24
    R4-R5: 192.168.3.0/30
    R5-R1: 192.168.4.0/30

OSPF Area 0 (backbone):

    R1-R2-R3 (через switch): 10.0.0.0/24

OSPF Area 1 (totally stub):

    R3-R8: 10.1.0.0/30
    PC5-R8: 172.16.1.0/24

OSPF Area 2:

    R2-R6: 10.2.0.0/30
    R3-R7: 10.2.1.0/30
    R6-R7: 10.2.2.0/30
    PC3-R6: 172.16.2.0/24
    PC4-R7: 172.16.3.0/24

Все интерфейсы маршрутизаторов получили статические IP-адреса в соответствующих подсетях, VPC получили статические адреса с шлюзами на ближайших маршрутизаторах.

---
2) **Настроить протокол динамической маршрутизации RIP v2 для области, указанной на схеме schema-lab5.**

На маршрутизаторах R4 и R5 был включен RIP v2 с параметрами:

``` 
router rip
    version 2
    no auto-summary
    network 192.168.2.0
    network 192.168.3.0
    network 192.168.4.0
```

R1 также участвует в RIP только на интерфейсе к R5 для последующей редистрибуции.

---
3) **Настроить протокол динамической маршрутизации OSPF для зон 0, 1, 2. Зону 1 настроить как полностью (nb!) тупиковую.**

#### Настройка Area 0:
Сеть 10.0.0.0/24 (сегмент между R1, R2, R3 через switch)

Настройки R1:
```
router ospf 1
    router-id 1.1.1.1
    network 10.0.0.0 0.0.0.255 area 0
```

Настройки R2:
```
router ospf 1
    router-id 2.2.2.2
    network 10.0.0.0 0.0.0.255 area 0
```

Настройки R3:
```
router ospf 1
    router-id 3.3.3.3
    network 10.0.0.0 0.0.0.255 area 0
```

#### Настройка Area 1 (totally stub):
Сеть 10.1.0.0/30 (связь R3—R8)\
Сеть 192.168.1.0/24 (LAN PC5)

Особенность totally stub:\
На ABR (R3) прописывается: `area 1 stub no-summary`, это означает, что внутрь Area 1 передается только маршрут по умолчанию (0.0.0.0/0).
На внутренних маршрутизаторах Area 1 (R8) пишется: `area 1 stub`.

Настройки R3:
```
router ospf 1
    network 10.1.0.0 0.0.0.3 area 1
     area 1 stub no-summary
```

Настройки R8:
```
router ospf 1
    router-id 8.8.8.8
    network 10.1.0.0 0.0.0.3 area 1
    network 192.168.1.0 0.0.0.255 area 1
    area 1 stub
```
В результате: R8 видит только дефолтный маршрут, ведущий в сторону R3, и свой LAN.

#### Настройки Area 2:

R2—R6 (10.2.0.0/30)\
R3—R7 (10.2.1.0/30)\
R6—R7 (10.2.2.0/30)\
LAN PC3 (172.16.2.0/24)\
LAN PC4 (172.16.3.0/24)\

Настройки R2:
```
router ospf 1
    network 10.2.0.0 0.0.0.3 area 2
```

Настройки R3:
```
router ospf 1
    network 10.2.1.0 0.0.0.3 area 2
```

Настройки R6:
```
router ospf 1
    router-id 6.6.6.6
    network 10.2.0.0 0.0.0.3 area 2
    network 10.2.2.0 0.0.0.3 area 2
    network 172.16.2.0 0.0.0.255 area 2
```

Настройки R7:
```
router ospf 1
    router-id 7.7.7.7
    network 10.2.1.0 0.0.0.3 area 2
    network 10.2.2.0 0.0.0.3 area 2
    network 172.16.3.0 0.0.0.255 area 2
```
---
4) **Настроить редистрибуцию маршрутов между протоколами RIP v2 и OSPF.**

Редистрибуция выполнена на R1, который является пограничным между RIP и OSPF:
```
router ospf 1
    redistribute rip subnets metric 20
router rip
    default-metric 2
    redistribute ospf 1
```

Таким образом, все маршруты из RIP попадают в OSPF, а маршруты из OSPF анонсируются в RIP.

---
5) **Проверить работоспособность маршрутизации, выполнив ping VPC "все между всеми" (nb!: в обе стороны).**

Результаты выполнения ping-запросов находятся в [ping.md](ping.md).

---
6) **Перехватить в wireshark сообщения протоколов RIP v2 и OSPF, идентифицировать их тип и содержание.**

Сообщения RIP v2:s

Передаются по UDP на порте 520, и имеют две разновидности: **Request** и **Response**.
**Request** используется для запроса маршрутов у соседей, когда маршрутизатор только включился он отправляет такие запросы. В поле адреса получателя указывается multicast адрес для протокола RIP.
Второй вид **Response** содержит список маршрутов и их метрик и используется для ответа на запрос и для переодической рассылки обновлений на multicast адрес.

Сообщения OSPF:
Передаются непосредственно поверх IP-протокола (номер протокола 89, без UDP/TCP).
OSPF имеет несколько типов сообщений, которые служат для установления соседства, обмена маршрутной информацией и поддержания актуальной базы данных состояний каналов.
Основные типы:

**Hello** - используется для обнаружения соседей и поддержания отношений с ними. Передаётся на multicast-адрес 224.0.0.5. Содержит информацию о Router ID, таймерах, флагах и списке соседей.

**Database Description** - обмен краткими описаниями содержимого базы данных маршрутизатора. На этом этапе соседи узнают, какие LSA имеются у соседа.

**Link State Request** - запрос конкретных LSA, которые отсутствуют или устарели в локальной базе.

**Link State Update** - сообщение, содержащее одну или несколько LSA. Используется для рассылки новой информации о состоянии сети.

**Link State Acknowledgment** - подтверждение приёма LSA, чтобы гарантировать надёжную доставку.

Сообщения OSPF также передаются на мультикаст-адреса:

224.0.0.5 - для всех маршрутизаторов OSPF,

224.0.0.6 - для всех DR/BDR (Designated/Backup Designated Router).

---
7) **Сохранить в отдельные файлы с префиксом rt_ и именем маршрутизатора таблицы маршрутизации всех маршрутизаторов.**

[rt_1.route](rt_1.route)

[rt_2.route](rt_2.route)

[rt_3.route](rt_3.route)

[rt_4.route](rt_4.route)

[rt_5.route](rt_5.route)

[rt_6.route](rt_6.route)

[rt_7.route](rt_7.route)

[rt_8.route](rt_8.route)

---
8) **Сохранить файлы конфигураций устройств в виде набора файлов с именами, соответствующими именам устройств.**

[R1.cfg](R1.cfg)

[R2.cfg](R2.cfg)

[R3.cfg](R3.cfg)

[R4.cfg](R4.cfg)

[R5.cfg](R5.cfg)

[R6.cfg](R6.cfg)

[R7.cfg](R7.cfg)

[R8.cfg](R8.cfg)

[SW.cfg](SW.cfg)


